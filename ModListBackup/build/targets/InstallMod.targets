<?xml version="1.0" encoding="UTF-8"?>
<!--
  This is a msbuild task that will copy the compilled mod from the output folder
  into RimWorlds mod folder if it is installed.

  This will execute AFTER build

  NOTE: Do not Edit this file unless you know what you are doing.
        If your RimWorld install is not detected, add the folder to 
        "RimWorldLocations.txt"
-->
<Project DefaultTargets="AfterBuild" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="..\tasks\FindRimWorld.task" />
	<PropertyGroup Condition=" '$(OS)' == 'Windows_NT' ">
		<CopyCommand>xcopy /I /E /Y</CopyCommand>
	</PropertyGroup>
	<PropertyGroup Condition=" '$(OS)' != 'Windows_NT' ">
		<CopyCommand>cp -rT</CopyCommand>
		<DeleteCommand>rm -rf</DeleteCommand>
	</PropertyGroup>
	<Target Name="InstallMod" AfterTargets="AfterBuild">
		<FindRimWorld Condition="'$(RimWorldInstall)' == ''">
			<Output TaskParameter="RimWorldInstall" PropertyName="RimWorldInstall" />
			<Output TaskParameter="IsInstalled" PropertyName="IsInstalled" />
		</FindRimWorld>
		<Message Text="RimWorld not found, skipping install" Importance="high" Condition="!$(IsInstalled)" />
		<Message Text="If it is installed, check the path are correct in 'RimWorldLocations.txt'" Importance="high" Condition="'!$(IsInstalled)'" />
		<Message Text="Installing $(MSBuildProjectName)..." Importance="high" Condition="'$(IsInstalled)'" />
		<Exec Command="$(CopyCommand) &quot;$(ProjectDir)Output\$(MSBuildProjectName)&quot; &quot;$(RimWorldInstall)\Mods\$(MSBuildProjectName)&quot;" ConsoleToMSBuild="true" Condition="'$(IsInstalled)'" />
		<Message Text="Installed $(MSBuildProjectName)" Importance="high" Condition="'$(IsInstalled)'" />
	</Target>
</Project>